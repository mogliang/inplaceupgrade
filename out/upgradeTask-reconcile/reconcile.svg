<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="1125px" preserveAspectRatio="none" style="width:1419px;height:1125px;background:#FFFFFF;" version="1.1" viewBox="0 0 1419 1125" width="1419px" zoomAndPan="magnify"><defs/><g><ellipse cx="738" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="149" x="663.5" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="129" x="673.5" y="72.457">UpgradeTask controller</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="298" x="589" y="105.0938"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="278" x="599" y="127.5508">UpgradeTask controller enquenes a Reconcile call</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="279" x="598.5" y="160.1875"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="259" x="608.5" y="182.6445">Get Machines for given MachineDeployment/CP</text><polygon fill="#F1F1F1" points="481.625,215.2813,616.625,215.2813,628.625,227.2813,616.625,239.2813,481.625,239.2813,469.625,227.2813,481.625,215.2813" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="553.125" y="250.7002">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="135" x="481.625" y="231.7822">UpgradeTask stage ongoing</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="312" x="393.125" y="376.2119"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="292" x="403.125" y="398.6689">Add MachineUpToDate condition with reason 'waiting'</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="156" x="471.125" y="446.3057"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="136" x="481.125" y="468.7627">Add UpgradeTask owner</text><polygon fill="#F1F1F1" points="450.625,327.2939,647.625,327.2939,659.625,339.2939,647.625,351.2939,450.625,351.2939,438.625,339.2939,450.625,327.2939" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="553.125" y="362.7129">no</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="197" x="450.625" y="343.7949">Is Machine owned by any UpgradeTask?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="659.625" y="336.877">yes</text><polygon fill="#F1F1F1" points="549.125,506.3174,561.125,518.3174,549.125,530.3174,537.125,518.3174,549.125,506.3174" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="494.125" y="272.2002"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="90" x="504.125" y="294.6572">iterate Machines</text><polygon fill="#F1F1F1" points="509.625,578.3174,588.625,578.3174,600.625,590.3174,588.625,602.3174,509.625,602.3174,497.625,590.3174,509.625,578.3174" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="509.625" y="594.8184">more Machines?</text><polygon fill="#F1F1F1" points="432.625,637.3174,665.625,637.3174,677.625,658.0713,665.625,678.8252,432.625,678.8252,420.625,658.0713,432.625,637.3174" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="230" x="432.625" y="648.7363">Query owned Machines, find machine which its</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="181" x="432.625" y="662.5723">MachineUpToDate condition reason is</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="136" x="432.625" y="676.4082">'ExternalUpgradeInProgress'</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="28" x="392.625" y="655.6543">found</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="677.625" y="655.6543">no</text><rect fill="#90EE90" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="144" x="207.5" y="688.8252"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="32" x="217.5" y="711.2822">Doing</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="252.5" y="711.2822">inplace upgrade</text><polygon fill="#F1F1F1" points="88,783.9189,180,783.9189,192,795.9189,180,807.9189,88,807.9189,76,795.9189,88,783.9189" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="138" y="819.3379">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="92" x="88" y="800.4199">Upgrade succeed?</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="140" x="64" y="841.7549"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="120" x="74" y="864.2119">Update Machine Spec</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="246" x="11" y="911.8486"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="226" x="21" y="934.3057">Mark MachineUpToDate condition 'Ready'</text><polygon fill="#F1F1F1" points="324.5,783.9189,450.5,783.9189,462.5,795.9189,450.5,807.9189,324.5,807.9189,312.5,795.9189,324.5,783.9189" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="391.5" y="819.3379">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="126" x="324.5" y="800.4199">Upgrade failed or timeout?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="462.5" y="793.502">no</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="221" x="277" y="841.7549"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198" x="287" y="864.2119">Update MachineUpToDate condition</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="93" x="287" y="879.3057">reason to 'Failed'</text><polygon fill="#F1F1F1" points="719.75,688.8252,917.75,688.8252,929.75,702.6611,917.75,716.4971,719.75,716.4971,707.75,702.6611,719.75,688.8252" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="195" x="719.75" y="700.2441">Select 1 owned Machine to be upgraded</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="119" x="719.75" y="714.0801">based on preflight check</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="41" x="666.75" y="700.2441">selected</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="929.75" y="700.2441">no</text><rect fill="#F1F1F1" height="50.1875" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="232" x="578" y="726.4971"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="198" x="588" y="748.9541">Update MachineUpToDate condition</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212" x="588" y="764.0479">reason to 'ExternalUpgradeInProgress'</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="207" x="840" y="775.415"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="187" x="850" y="797.8721">Mark UpgradeTask status to ready</text><ellipse cx="943.5" cy="856.5088" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="943.5" cy="856.5088" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><polygon fill="#F1F1F1" points="888.5,726.4971,998.5,726.4971,1010.5,738.4971,998.5,750.4971,888.5,750.4971,876.5,738.4971,888.5,726.4971" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="947.5" y="761.916">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="110" x="888.5" y="742.998">All Machine upgraded?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="1010.5" y="736.0801">no</text><polygon fill="#F1F1F1" points="818.75,904.4268,830.75,916.4268,818.75,928.4268,806.75,916.4268,818.75,904.4268" style="stroke:#181818;stroke-width:0.5;"/><polygon fill="#F1F1F1" points="549.125,972.9424,561.125,984.9424,549.125,996.9424,537.125,984.9424,549.125,972.9424" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="86" x="506.125" y="1016.9424"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="66" x="516.125" y="1039.3994">ReEnqueue</text><polygon fill="#F1F1F1" points="1144,215.2813,1278,215.2813,1290,227.2813,1278,239.2813,1144,239.2813,1132,227.2813,1144,215.2813" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="1215" y="250.7002">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="134" x="1144" y="231.7822">UpgradeTask stage aborted</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="1290" y="224.8643">no</text><rect fill="#90EE90" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="143" x="1139.5" y="425.1299"/><text fill="#000000" font-family="sans-serif" font-size="12" font-weight="bold" lengthAdjust="spacing" textLength="31" x="1149.5" y="447.5869">Abort</text><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="89" x="1183.5" y="447.5869">inplace upgrade</text><polygon fill="#F1F1F1" points="1107,376.2119,1315,376.2119,1327,388.2119,1315,400.2119,1107,400.2119,1095,388.2119,1107,376.2119" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="1215" y="411.6309">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="208" x="1107" y="392.7129">Check if machine is doing inplace upgrade?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="1327" y="385.7949">no</text><polygon fill="#F1F1F1" points="1211,485.1416,1223,497.1416,1211,509.1416,1199,497.1416,1211,485.1416" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="224" x="1099" y="544.1416"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="204" x="1109" y="566.5986">Remove MachineUpToDate condition</text><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="181" x="1120.5" y="614.2354"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="161" x="1130.5" y="636.6924">Remove UpgradeTask owner</text><polygon fill="#F1F1F1" points="1083,327.2939,1339,327.2939,1351,339.2939,1339,351.2939,1083,351.2939,1071,339.2939,1083,327.2939" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="18" x="1215" y="362.7129">yes</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="256" x="1083" y="343.7949">Check if machine is owned by current UpgradeTask?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="12" x="1351" y="336.877">no</text><polygon fill="#F1F1F1" points="1211,674.2471,1223,686.2471,1211,698.2471,1199,686.2471,1211,674.2471" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#F1F1F1" height="35.0938" rx="12.5" ry="12.5" style="stroke:#181818;stroke-width:0.5;" width="110" x="1156" y="272.2002"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="90" x="1166" y="294.6572">iterate Machines</text><polygon fill="#F1F1F1" points="1171.5,746.2471,1250.5,746.2471,1262.5,758.2471,1250.5,770.2471,1171.5,770.2471,1159.5,758.2471,1171.5,746.2471" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="79" x="1171.5" y="762.748">more machines?</text><ellipse cx="738" cy="1103.0361" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="738" cy="1103.0361" fill="#222222" rx="6" ry="6" style="stroke:#111111;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="738" y1="30" y2="50"/><polygon fill="#181818" points="734,40,738,50,742,40,738,44" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="738" y1="85.0938" y2="105.0938"/><polygon fill="#181818" points="734,95.0938,738,105.0938,742,95.0938,738,99.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="738" y1="140.1875" y2="160.1875"/><polygon fill="#181818" points="734,150.1875,738,160.1875,742,150.1875,738,154.1875" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="411.3057" y2="446.3057"/><polygon fill="#181818" points="545.125,436.3057,549.125,446.3057,553.125,436.3057,549.125,440.3057" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="351.2939" y2="376.2119"/><polygon fill="#181818" points="545.125,366.2119,549.125,376.2119,553.125,366.2119,549.125,370.2119" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="659.625" x2="715.125" y1="339.2939" y2="339.2939"/><polygon fill="#181818" points="711.125,418.8057,715.125,428.8057,719.125,418.8057,715.125,422.8057" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="715.125" x2="715.125" y1="339.2939" y2="518.3174"/><line style="stroke:#181818;stroke-width:1.0;" x1="715.125" x2="561.125" y1="518.3174" y2="518.3174"/><polygon fill="#181818" points="571.125,514.3174,561.125,518.3174,571.125,522.3174,567.125,518.3174" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="481.3994" y2="506.3174"/><polygon fill="#181818" points="545.125,496.3174,549.125,506.3174,553.125,496.3174,549.125,500.3174" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="307.2939" y2="327.2939"/><polygon fill="#181818" points="545.125,317.2939,549.125,327.2939,553.125,317.2939,549.125,321.2939" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="600.625" x2="739.125" y1="590.3174" y2="590.3174"/><polygon fill="#181818" points="735.125,436.0322,739.125,426.0322,743.125,436.0322,739.125,432.0322" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="739.125" x2="739.125" y1="289.7471" y2="590.3174"/><line style="stroke:#181818;stroke-width:1.0;" x1="739.125" x2="604.125" y1="289.7471" y2="289.7471"/><polygon fill="#181818" points="614.125,285.7471,604.125,289.7471,614.125,293.7471,610.125,289.7471" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="530.3174" y2="578.3174"/><polygon fill="#181818" points="545.125,568.3174,549.125,578.3174,553.125,568.3174,549.125,572.3174" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="134" x2="134" y1="876.8486" y2="911.8486"/><polygon fill="#181818" points="130,901.8486,134,911.8486,138,901.8486,134,905.8486" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="134" x2="134" y1="807.9189" y2="841.7549"/><polygon fill="#181818" points="130,831.7549,134,841.7549,138,831.7549,134,835.7549" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="134" x2="134" y1="946.9424" y2="966.9424"/><polygon fill="#181818" points="130,956.9424,134,966.9424,138,956.9424,134,960.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="387.5" x2="387.5" y1="807.9189" y2="841.7549"/><polygon fill="#181818" points="383.5,831.7549,387.5,841.7549,391.5,831.7549,387.5,835.7549" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="387.5" x2="387.5" y1="891.9424" y2="966.9424"/><polygon fill="#181818" points="383.5,956.9424,387.5,966.9424,391.5,956.9424,387.5,960.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="192" x2="312.5" y1="795.9189" y2="795.9189"/><polygon fill="#181818" points="302.5,791.9189,312.5,795.9189,302.5,799.9189,306.5,795.9189" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="279.5" y1="723.9189" y2="758.9189"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="134" y1="758.9189" y2="758.9189"/><line style="stroke:#181818;stroke-width:1.0;" x1="134" x2="134" y1="758.9189" y2="783.9189"/><polygon fill="#181818" points="130,773.9189,134,783.9189,138,773.9189,134,777.9189" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="462.5" x2="533" y1="795.9189" y2="795.9189"/><line style="stroke:#181818;stroke-width:1.0;" x1="533" x2="533" y1="795.9189" y2="966.9424"/><polygon fill="#181818" points="529,956.9424,533,966.9424,537,956.9424,533,960.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="134" x2="533" y1="966.9424" y2="966.9424"/><line style="stroke:#181818;stroke-width:1.0;" x1="943.5" x2="943.5" y1="810.5088" y2="845.5088"/><polygon fill="#181818" points="939.5,835.5088,943.5,845.5088,947.5,835.5088,943.5,839.5088" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="943.5" x2="943.5" y1="750.4971" y2="775.415"/><polygon fill="#181818" points="939.5,765.415,943.5,775.415,947.5,765.415,943.5,769.415" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1010.5" x2="1057" y1="738.4971" y2="738.4971"/><polygon fill="#181818" points="1053,817.4619,1057,827.4619,1061,817.4619,1057,821.4619" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1057" x2="1057" y1="738.4971" y2="916.4268"/><line style="stroke:#181818;stroke-width:1.0;" x1="1057" x2="830.75" y1="916.4268" y2="916.4268"/><polygon fill="#181818" points="840.75,912.4268,830.75,916.4268,840.75,920.4268,836.75,916.4268" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="707.75" x2="694" y1="702.6611" y2="702.6611"/><line style="stroke:#181818;stroke-width:1.0;" x1="694" x2="694" y1="702.6611" y2="726.4971"/><polygon fill="#181818" points="690,716.4971,694,726.4971,698,716.4971,694,720.4971" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="929.75" x2="943.5" y1="702.6611" y2="702.6611"/><line style="stroke:#181818;stroke-width:1.0;" x1="943.5" x2="943.5" y1="702.6611" y2="726.4971"/><polygon fill="#181818" points="939.5,716.4971,943.5,726.4971,947.5,716.4971,943.5,720.4971" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="694" x2="694" y1="776.6846" y2="916.4268"/><line style="stroke:#181818;stroke-width:1.0;" x1="694" x2="806.75" y1="916.4268" y2="916.4268"/><polygon fill="#181818" points="796.75,912.4268,806.75,916.4268,796.75,920.4268,800.75,916.4268" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="420.625" x2="279.5" y1="658.0713" y2="658.0713"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="279.5" y1="658.0713" y2="688.8252"/><polygon fill="#181818" points="275.5,678.8252,279.5,688.8252,283.5,678.8252,279.5,682.8252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="677.625" x2="818.75" y1="658.0713" y2="658.0713"/><line style="stroke:#181818;stroke-width:1.0;" x1="818.75" x2="818.75" y1="658.0713" y2="688.8252"/><polygon fill="#181818" points="814.75,678.8252,818.75,688.8252,822.75,678.8252,818.75,682.8252" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="279.5" y1="966.9424" y2="984.9424"/><line style="stroke:#181818;stroke-width:1.0;" x1="279.5" x2="537.125" y1="984.9424" y2="984.9424"/><polygon fill="#181818" points="527.125,980.9424,537.125,984.9424,527.125,988.9424,531.125,984.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="818.75" x2="818.75" y1="928.4268" y2="984.9424"/><line style="stroke:#181818;stroke-width:1.0;" x1="818.75" x2="561.125" y1="984.9424" y2="984.9424"/><polygon fill="#181818" points="571.125,980.9424,561.125,984.9424,571.125,988.9424,567.125,984.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="602.3174" y2="637.3174"/><polygon fill="#181818" points="545.125,627.3174,549.125,637.3174,553.125,627.3174,549.125,631.3174" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="996.9424" y2="1016.9424"/><polygon fill="#181818" points="545.125,1006.9424,549.125,1016.9424,553.125,1006.9424,549.125,1010.9424" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="400.2119" y2="425.1299"/><polygon fill="#181818" points="1207,415.1299,1211,425.1299,1215,415.1299,1211,419.1299" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1327" x2="1339" y1="388.2119" y2="388.2119"/><polygon fill="#181818" points="1335,432.6768,1339,442.6768,1343,432.6768,1339,436.6768" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1339" x2="1339" y1="388.2119" y2="497.1416"/><line style="stroke:#181818;stroke-width:1.0;" x1="1339" x2="1223" y1="497.1416" y2="497.1416"/><polygon fill="#181818" points="1233,493.1416,1223,497.1416,1233,501.1416,1229,497.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="460.2236" y2="485.1416"/><polygon fill="#181818" points="1207,475.1416,1211,485.1416,1215,475.1416,1211,479.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="509.1416" y2="544.1416"/><polygon fill="#181818" points="1207,534.1416,1211,544.1416,1215,534.1416,1211,538.1416" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="579.2354" y2="614.2354"/><polygon fill="#181818" points="1207,604.2354,1211,614.2354,1215,604.2354,1211,608.2354" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="351.2939" y2="376.2119"/><polygon fill="#181818" points="1207,366.2119,1211,376.2119,1215,366.2119,1211,370.2119" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1351" x2="1363" y1="339.2939" y2="339.2939"/><polygon fill="#181818" points="1359,502.7705,1363,512.7705,1367,502.7705,1363,506.7705" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1363" x2="1363" y1="339.2939" y2="686.2471"/><line style="stroke:#181818;stroke-width:1.0;" x1="1363" x2="1223" y1="686.2471" y2="686.2471"/><polygon fill="#181818" points="1233,682.2471,1223,686.2471,1233,690.2471,1229,686.2471" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="649.3291" y2="674.2471"/><polygon fill="#181818" points="1207,664.2471,1211,674.2471,1215,664.2471,1211,668.2471" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="307.2939" y2="327.2939"/><polygon fill="#181818" points="1207,317.2939,1211,327.2939,1215,317.2939,1211,321.2939" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1262.5" x2="1375" y1="758.2471" y2="758.2471"/><polygon fill="#181818" points="1371,519.9971,1375,509.9971,1379,519.9971,1375,515.9971" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1375" x2="1375" y1="289.7471" y2="758.2471"/><line style="stroke:#181818;stroke-width:1.0;" x1="1375" x2="1266" y1="289.7471" y2="289.7471"/><polygon fill="#181818" points="1276,285.7471,1266,289.7471,1276,293.7471,1272,289.7471" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="698.2471" y2="746.2471"/><polygon fill="#181818" points="1207,736.2471,1211,746.2471,1215,736.2471,1211,740.2471" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="239.2813" y2="272.2002"/><polygon fill="#181818" points="545.125,262.2002,549.125,272.2002,553.125,262.2002,549.125,266.2002" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="1052.0361" y2="1072.0361"/><polygon fill="#181818" points="545.125,1062.0361,549.125,1072.0361,553.125,1062.0361,549.125,1066.0361" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="239.2813" y2="272.2002"/><polygon fill="#181818" points="1207,262.2002,1211,272.2002,1215,262.2002,1211,266.2002" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1211" x2="1211" y1="770.2471" y2="1072.0361"/><polygon fill="#181818" points="1207,1062.0361,1211,1072.0361,1215,1062.0361,1211,1066.0361" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="628.625" x2="1132" y1="227.2813" y2="227.2813"/><polygon fill="#181818" points="1122,223.2813,1132,227.2813,1122,231.2813,1126,227.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="738" y1="195.2813" y2="200.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="549.125" y1="200.2813" y2="200.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="549.125" y1="200.2813" y2="215.2813"/><polygon fill="#181818" points="545.125,205.2813,549.125,215.2813,553.125,205.2813,549.125,209.2813" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="1290" x2="1393" y1="227.2813" y2="227.2813"/><line style="stroke:#181818;stroke-width:1.0;" x1="1393" x2="1393" y1="227.2813" y2="1072.0361"/><polygon fill="#181818" points="1389,1062.0361,1393,1072.0361,1397,1062.0361,1393,1066.0361" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="549.125" x2="1393" y1="1072.0361" y2="1072.0361"/><line style="stroke:#181818;stroke-width:1.0;" x1="738" x2="738" y1="1072.0361" y2="1092.0361"/><polygon fill="#181818" points="734,1082.0361,738,1092.0361,742,1082.0361,738,1086.0361" style="stroke:#181818;stroke-width:1.0;"/><!--MD5=[2863e3ac813a7a775c335dfadcb69f3c]
@startuml reconcile

start

:UpgradeTask controller;
:UpgradeTask controller enquenes a Reconcile call;
:Get Machines for given MachineDeployment/CP;

if (UpgradeTask stage ongoing) then (yes)
  repeat :iterate Machines
    if (Is Machine owned by any UpgradeTask?) then (no)
        :Add MachineUpToDate condition with reason 'waiting';
        :Add UpgradeTask owner;
    else (yes)
    endif
  repeat while (more Machines?)
  if (Query owned Machines, find machine which its \nMachineUpToDate condition reason is \n'ExternalUpgradeInProgress') then (found)
    #lightGreen:**Doing** inplace upgrade;
    if (Upgrade succeed?) then (yes)
      :Update Machine Spec;
      :Mark MachineUpToDate condition 'Ready';
    else if (Upgrade failed or timeout?) then (yes)
      :Update MachineUpToDate condition \nreason to 'Failed';
    else (no)
    endif
  else (no)
    if (Select 1 owned Machine to be upgraded \nbased on preflight check) then (selected)
      :Update MachineUpToDate condition \nreason to 'ExternalUpgradeInProgress';
    else (no)
      if (All Machine upgraded?) then (yes)
        :Mark UpgradeTask status to ready;
        stop
      else (no)
      endif
    endif
  endif
  :ReEnqueue;
else if (UpgradeTask stage aborted) then (yes)
  repeat :iterate Machines
    if (Check if machine is owned by current UpgradeTask?) then (yes)
        if (Check if machine is doing inplace upgrade?) then (yes)
          #lightGreen:**Abort** inplace upgrade;
        else (no)
        endif
        :Remove MachineUpToDate condition;
        :Remove UpgradeTask owner;
    else (no)
    endif
  repeat while (more machines?)
else (no)
endif

stop

@enduml

PlantUML version 1.2022.7(Tue Aug 23 01:01:30 CST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: Cp1252
Language: en
Country: US
--></g></svg>